# äº”ä¸ªåº“çš„å®‰è£…å’Œç¼–è¯‘é…ç½®è¯´æ˜

**æ–‡æ¡£æ—¥æœŸ**: 2025-10-14  
**åŒ…å«åº“**: AMGX, HYPRE-CPU, HYPRE-GPU, PETSc-CPU, PETSc-GPU

---

## ğŸ“‹ åº“æ¸…å•

| åº“ | ç‰ˆæœ¬ | æ¨¡å¼ | å®‰è£…è·¯å¾„ |
|---|------|------|---------|
| **AMGX** | v2.4.0 | GPU | `/home/zzy/Plasma/gpu/amgx/install` |
| **HYPRE-CPU** | 2.31.0 | CPU | `/home/zzy/Plasma/gpu/hypre_cpu` |
| **HYPRE-GPU** | 2.31.0 | GPU | `/home/zzy/Plasma/gpu/hypre_gpu` |
| **PETSc** | 3.22.2 | CPU+GPU | `/home/zzy/Plasma/gpu/petsc-gpu/install` |
| **yaml-cpp** | master | - | `/home/zzy/Plasma/gpu/ltpDeps-v2412/extract/yaml-cpp-master` |

**æ³¨æ„**: PETSc æ˜¯åŒä¸€ä¸ªå®‰è£…ï¼Œæ”¯æŒ CPU å’Œ GPU ä¸¤ç§æ¨¡å¼ï¼ˆé€šè¿‡çŸ©é˜µç±»å‹åŒºåˆ†ï¼‰

---

## 1ï¸âƒ£ AMGX v2.4.0

### åŸºæœ¬ä¿¡æ¯

- **å®˜æ–¹ä»“åº“**: https://github.com/NVIDIA/AMGX
- **ç‰ˆæœ¬**: v2.4.0 (ç¨³å®šç‰ˆ)
- **ç±»å‹**: ä»… GPU
- **æºä»£ç **: `/home/zzy/Plasma/gpu/amgx`
- **å®‰è£…è·¯å¾„**: `/home/zzy/Plasma/gpu/amgx/install`

### ç¼–è¯‘é…ç½®

```bash
# 1. ä¸‹è½½æºä»£ç 
cd /home/zzy/Plasma/gpu
git clone https://github.com/NVIDIA/AMGX.git amgx
cd amgx

# 2. åˆ‡æ¢åˆ°ç¨³å®šç‰ˆæœ¬
git checkout v2.4.0

# 3. åˆå§‹åŒ–å­æ¨¡å—
git submodule update --init --recursive

# 4. åˆ›å»ºæ„å»ºç›®å½•
mkdir build && cd build

# 5. CMake é…ç½®
cmake .. \
  -DCMAKE_BUILD_TYPE=Release \
  -DCMAKE_INSTALL_PREFIX=../install \
  -DCUDA_ARCH="70;75;80;86;89;90"

# 6. ç¼–è¯‘å’Œå®‰è£…
make -j$(nproc)
make install
```

### å…³é”®é…ç½®å‚æ•°

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|---|------|
| `CMAKE_BUILD_TYPE` | Release | ä¼˜åŒ–æ„å»º |
| `CMAKE_INSTALL_PREFIX` | ../install | å®‰è£…è·¯å¾„ |
| `CUDA_ARCH` | 70;75;80;86;89;90 | æ”¯æŒçš„ GPU æ¶æ„ |

### ç”Ÿæˆçš„æ–‡ä»¶

```
amgx/install/
â”œâ”€â”€ include/
â”‚   â”œâ”€â”€ amgx_c.h          # C API å¤´æ–‡ä»¶
â”‚   â””â”€â”€ amgx_config.h     # é…ç½®å¤´æ–‡ä»¶
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ libamgx.a         # é™æ€åº“ (533 MB)
â”‚   â”œâ”€â”€ libamgxsh.so      # åŠ¨æ€åº“ (377 MB)
â”‚   â”œâ”€â”€ configs/          # 30+ ä¸ªé¢„é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ examples/         # ç¤ºä¾‹ç¨‹åº
â””â”€â”€ ...
```

### é“¾æ¥æ–¹å¼

**åŠ¨æ€é“¾æ¥ï¼ˆæ¨èï¼‰**:
```cmake
target_link_libraries(your_target ${AMGX_DIR}/lib/libamgxsh.so)
```

**é™æ€é“¾æ¥**:
```cmake
target_link_libraries(your_target ${AMGX_DIR}/lib/libamgx.a gomp)  # éœ€è¦ gomp (OpenMP)
```

---

## 2ï¸âƒ£ HYPRE-CPU 2.31.0

### åŸºæœ¬ä¿¡æ¯

- **å®˜æ–¹ç½‘ç«™**: https://computing.llnl.gov/projects/hypre-scalable-linear-solvers-multigrid-methods
- **ç‰ˆæœ¬**: 2.31.0
- **ç±»å‹**: CPU ä¼˜åŒ–
- **å®‰è£…è·¯å¾„**: `/home/zzy/Plasma/gpu/hypre_cpu`

### ç¼–è¯‘é…ç½®

```bash
# 1. ä¸‹è½½æºä»£ç 
cd /home/zzy/Plasma/gpu
wget https://github.com/hypre-space/hypre/archive/refs/tags/v2.31.0.tar.gz
tar xzf v2.31.0.tar.gz
mv hypre-2.31.0 hypre_cpu
cd hypre_cpu/src

# 2. é…ç½®ï¼ˆCPU æ¨¡å¼ï¼‰
./configure \
  --prefix=/home/zzy/Plasma/gpu/hypre_cpu \
  --enable-shared \
  --with-MPI \
  --with-openmp \
  CFLAGS="-O3 -march=native" \
  CXXFLAGS="-O3 -march=native"

# 3. ç¼–è¯‘å’Œå®‰è£…
make -j$(nproc)
make install
```

### å…³é”®é…ç½®å‚æ•°

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|---|------|
| `--prefix` | /home/zzy/Plasma/gpu/hypre_cpu | å®‰è£…è·¯å¾„ |
| `--enable-shared` | - | ç”ŸæˆåŠ¨æ€åº“ |
| `--with-MPI` | - | å¯ç”¨ MPI æ”¯æŒ |
| `--with-openmp` | - | å¯ç”¨ OpenMP å¹¶è¡Œ |
| `CFLAGS` | -O3 -march=native | CPU ä¼˜åŒ– |

### ç”Ÿæˆçš„æ–‡ä»¶

```
hypre_cpu/
â”œâ”€â”€ include/
â”‚   â”œâ”€â”€ HYPRE.h
â”‚   â”œâ”€â”€ HYPRE_parcsr_ls.h
â”‚   â””â”€â”€ ...
â””â”€â”€ lib/
    â””â”€â”€ libHYPRE.a        # é™æ€åº“
```

### é“¾æ¥æ–¹å¼

```cmake
target_link_libraries(your_target ${HYPRE_CPU_DIR}/lib/libHYPRE.a)
```

---

## 3ï¸âƒ£ HYPRE-GPU 2.31.0

### åŸºæœ¬ä¿¡æ¯

- **ç‰ˆæœ¬**: 2.31.0
- **ç±»å‹**: GPU åŠ é€Ÿï¼ˆCUDA + Unified Memoryï¼‰
- **å®‰è£…è·¯å¾„**: `/home/zzy/Plasma/gpu/hypre_gpu`

### ç¼–è¯‘é…ç½®

```bash
# 1. ä¸‹è½½æºä»£ç 
cd /home/zzy/Plasma/gpu
wget https://github.com/hypre-space/hypre/archive/refs/tags/v2.31.0.tar.gz
tar xzf v2.31.0.tar.gz
mv hypre-2.31.0 hypre_gpu
cd hypre_gpu/src

# 2. é…ç½®ï¼ˆGPU æ¨¡å¼ï¼‰â­ å…³é”®
./configure \
  --prefix=/home/zzy/Plasma/gpu/hypre_gpu \
  --enable-shared \
  --with-MPI \
  --with-cuda \
  --enable-unified-memory \
  --with-gpu-arch=89 \
  CFLAGS="-O3" \
  CXXFLAGS="-O3" \
  CUFLAGS="-O3 -gencode arch=compute_89,code=sm_89"

# 3. ç¼–è¯‘å’Œå®‰è£…
make -j$(nproc)
make install
```

### å…³é”®é…ç½®å‚æ•°

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|---|------|
| `--prefix` | /home/zzy/Plasma/gpu/hypre_gpu | å®‰è£…è·¯å¾„ |
| `--with-cuda` | - | â­ å¯ç”¨ CUDA æ”¯æŒ |
| `--enable-unified-memory` | - | â­ å¯ç”¨ç»Ÿä¸€å†…å­˜ï¼ˆWSL å¿…éœ€ï¼‰ |
| `--with-gpu-arch` | 89 | GPU æ¶æ„ï¼ˆRTX 4060 Tiï¼‰ |
| `CUFLAGS` | -O3 -gencode... | CUDA ç¼–è¯‘ä¼˜åŒ– |

### GPU æ¶æ„å¯¹ç…§è¡¨

| GPU å‹å· | æ¶æ„ä»£ç  | `--with-gpu-arch` |
|---------|---------|------------------|
| RTX 3090 | SM 86 | `--with-gpu-arch=86` |
| RTX 4060 Ti | SM 89 | `--with-gpu-arch=89` |
| RTX 4090 | SM 89 | `--with-gpu-arch=89` |
| A100 | SM 80 | `--with-gpu-arch=80` |
| V100 | SM 70 | `--with-gpu-arch=70` |

### ç”Ÿæˆçš„æ–‡ä»¶

```
hypre_gpu/
â”œâ”€â”€ include/
â”‚   â”œâ”€â”€ HYPRE.h
â”‚   â”œâ”€â”€ HYPRE_parcsr_ls.h
â”‚   â””â”€â”€ ...
â””â”€â”€ lib/
    â””â”€â”€ libHYPRE.a        # é™æ€åº“ï¼ˆåŒ…å« CUDA ä»£ç ï¼‰
```

### é“¾æ¥æ–¹å¼

```cmake
target_link_libraries(your_target 
    ${HYPRE_GPU_DIR}/lib/libHYPRE.a
    -L/usr/local/cuda/lib64
    -lcusparse
    -lcublas
    -lcurand
    -lcusolver
)
```

---

## 4ï¸âƒ£ PETSc 3.22.2ï¼ˆç»Ÿä¸€å®‰è£…ï¼Œæ”¯æŒ CPU + GPUï¼‰

### åŸºæœ¬ä¿¡æ¯

- **å®˜æ–¹ç½‘ç«™**: https://petsc.org/
- **ç‰ˆæœ¬**: 3.22.2
- **ç±»å‹**: CPU + GPU æ··åˆ
- **æºä»£ç **: `/home/zzy/Plasma/gpu/petsc-gpu/petsc-3.22.2`
- **å®‰è£…è·¯å¾„**: `/home/zzy/Plasma/gpu/petsc-gpu/install`

### ç¼–è¯‘é…ç½®ï¼ˆGPU æ”¯æŒï¼‰â­

```bash
# 1. ä¸‹è½½æºä»£ç 
cd /home/zzy/Plasma/gpu
mkdir -p petsc-gpu && cd petsc-gpu
wget https://web.cels.anl.gov/projects/petsc/download/release-snapshots/petsc-3.22.2.tar.gz
tar xzf petsc-3.22.2.tar.gz
cd petsc-3.22.2

# 2. é…ç½®ï¼ˆCPU + GPU æ”¯æŒï¼‰â­ å…³é”®
./configure \
  --prefix=/home/zzy/Plasma/gpu/petsc-gpu/install \
  --with-cc=mpicc \
  --with-cxx=mpicxx \
  --with-fc=mpif90 \
  --with-cuda=1 \
  --with-cuda-dir=/usr/local/cuda \
  --with-cuda-arch=89 \
  --with-cudac=nvcc \
  CUDAFLAGS="-O3 -gencode arch=compute_89,code=sm_89" \
  COPTFLAGS="-O3 -march=native" \
  CXXOPTFLAGS="-O3 -march=native" \
  FOPTFLAGS="-O3" \
  --with-debugging=0 \
  --with-shared-libraries=1

# 3. ç¼–è¯‘
make PETSC_DIR=/home/zzy/Plasma/gpu/petsc-gpu/petsc-3.22.2 \
     PETSC_ARCH=arch-linux-c-opt all

# 4. å®‰è£…
make PETSC_DIR=/home/zzy/Plasma/gpu/petsc-gpu/petsc-3.22.2 \
     PETSC_ARCH=arch-linux-c-opt install

# 5. æµ‹è¯•ï¼ˆå¯é€‰ï¼‰
make PETSC_DIR=/home/zzy/Plasma/gpu/petsc-gpu/install test
```

### å…³é”®é…ç½®å‚æ•°

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|---|------|
| `--prefix` | .../install | å®‰è£…è·¯å¾„ |
| `--with-cuda` | 1 | â­ å¯ç”¨ CUDA æ”¯æŒ |
| `--with-cuda-arch` | 89 | â­ GPU æ¶æ„ï¼ˆRTX 4060 Tiï¼‰ |
| `CUDAFLAGS` | -gencode... | â­ ä»…ç¼–è¯‘ç‰¹å®šæ¶æ„ï¼ˆé¿å…å†…æ ¸é”™è¯¯ï¼‰ |
| `--with-debugging` | 0 | ç¦ç”¨è°ƒè¯•ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰ |
| `--with-shared-libraries` | 1 | ç”ŸæˆåŠ¨æ€åº“ |
| `COPTFLAGS` | -O3 -march=native | CPU ä¼˜åŒ– |

### ä¸ºä»€ä¹ˆ PETSc åŒæ—¶æ”¯æŒ CPU å’Œ GPUï¼Ÿ

PETSc é€šè¿‡**çŸ©é˜µå’Œå‘é‡ç±»å‹**åŒºåˆ† CPU å’Œ GPUï¼š

**CPU æ¨¡å¼**:
```cpp
MatSetType(A, MATAIJ);        // CPU çŸ©é˜µ
VecSetType(b, VECSTANDARD);   // CPU å‘é‡
```

**GPU æ¨¡å¼**:
```cpp
MatSetType(A, MATAIJCUSPARSE); // GPU çŸ©é˜µï¼ˆcuSPARSEï¼‰
VecSetType(b, VECCUDA);        // GPU å‘é‡
```

**åŒä¸€ä¸ª PETSc å®‰è£…ï¼Œæ ¹æ®ç±»å‹è‡ªåŠ¨é€‰æ‹© CPU æˆ– GPUï¼**

### ç”Ÿæˆçš„æ–‡ä»¶

```
petsc-gpu/install/
â”œâ”€â”€ include/
â”‚   â”œâ”€â”€ petsc.h
â”‚   â”œâ”€â”€ petscmat.h
â”‚   â”œâ”€â”€ petscvec.h
â”‚   â”œâ”€â”€ petscksp.h
â”‚   â””â”€â”€ ...
â””â”€â”€ lib/
    â”œâ”€â”€ libpetsc.so.3.22.2  # ä¸»åŠ¨æ€åº“
    â”œâ”€â”€ libpetsc.so.3.22    # ç‰ˆæœ¬é“¾æ¥
    â””â”€â”€ libpetsc.so         # ä¸»é“¾æ¥
```

### é“¾æ¥æ–¹å¼

```cmake
target_link_libraries(your_target ${PETSC_DIR}/lib/libpetsc.so)
```

---

## 5ï¸âƒ£ yaml-cpp (master)

### åŸºæœ¬ä¿¡æ¯

- **å®˜æ–¹ä»“åº“**: https://github.com/jbeder/yaml-cpp
- **ç‰ˆæœ¬**: master åˆ†æ”¯
- **ç±»å‹**: C++ åº“
- **æºä»£ç **: `/home/zzy/Plasma/gpu/ltpDeps-v2412/extract/yaml-cpp-master`

### ç¼–è¯‘é…ç½®

```bash
# 1. è¿›å…¥æºä»£ç ç›®å½•
cd /home/zzy/Plasma/gpu/ltpDeps-v2412/extract/yaml-cpp-master

# 2. åˆ›å»ºæ„å»ºç›®å½•
mkdir -p build && cd build

# 3. CMake é…ç½®
cmake .. \
  -DCMAKE_BUILD_TYPE=Release \
  -DYAML_CPP_BUILD_TESTS=OFF \
  -DYAML_CPP_BUILD_TOOLS=OFF

# 4. ç¼–è¯‘
make -j$(nproc)

# æ³¨æ„ï¼šæ— éœ€ make installï¼Œç›´æ¥ä½¿ç”¨ build/ ä¸­çš„åº“
```

### ç”Ÿæˆçš„æ–‡ä»¶

```
yaml-cpp-master/
â”œâ”€â”€ include/
â”‚   â””â”€â”€ yaml-cpp/
â”‚       â”œâ”€â”€ yaml.h
â”‚       â””â”€â”€ ...
â””â”€â”€ build/
    â””â”€â”€ libyaml-cpp.a     # é™æ€åº“
```

### é“¾æ¥æ–¹å¼

```cmake
target_include_directories(your_target PRIVATE ${YAML_CPP_DIR}/include)
target_link_libraries(your_target ${YAML_CPP_DIR}/build/libyaml-cpp.a)
```

---

## ğŸ“Š åº“å¯¹æ¯”æ€»ç»“

### ç¼–è¯‘å¤æ‚åº¦

| åº“ | å¤æ‚åº¦ | ç¼–è¯‘æ—¶é—´ | é…ç½®éš¾åº¦ |
|---|--------|---------|---------|
| **yaml-cpp** | â­ ç®€å• | ~1 åˆ†é’Ÿ | ç®€å• |
| **AMGX** | â­â­ ä¸­ç­‰ | ~5 åˆ†é’Ÿ | ä¸­ç­‰ |
| **HYPRE-CPU** | â­â­ ä¸­ç­‰ | ~10 åˆ†é’Ÿ | ç®€å• |
| **HYPRE-GPU** | â­â­â­ å¤æ‚ | ~15 åˆ†é’Ÿ | ä¸­ç­‰ |
| **PETSc** | â­â­â­â­ å¾ˆå¤æ‚ | ~20-30 åˆ†é’Ÿ | å¤æ‚ |

### ä¾èµ–å…³ç³»

```
yaml-cpp (æ— ä¾èµ–)
   â†“
AMGX (ä¾èµ–: CUDA, MPI)
   â†“
HYPRE-CPU (ä¾èµ–: MPI)
   â†“
HYPRE-GPU (ä¾èµ–: MPI, CUDA)
   â†“
PETSc (ä¾èµ–: MPI, CUDA, BLAS/LAPACK)
```

**å»ºè®®å®‰è£…é¡ºåº**: yaml-cpp â†’ AMGX â†’ HYPRE-CPU â†’ HYPRE-GPU â†’ PETSc

---

## ğŸ”§ åœ¨æ–°ç”µè„‘ä¸Šé‡æ–°å®‰è£…

### åœºæ™¯ 1: æ–°ç”µè„‘ï¼ˆä»å¤´å®‰è£…ï¼‰

```bash
# åˆ›å»ºå·¥ä½œç›®å½•
mkdir -p ~/libraries && cd ~/libraries

# 1. å®‰è£… yaml-cpp
git clone https://github.com/jbeder/yaml-cpp.git
cd yaml-cpp && mkdir build && cd build
cmake .. -DCMAKE_BUILD_TYPE=Release
make -j$(nproc)
cd ../..

# 2. å®‰è£… AMGX
git clone https://github.com/NVIDIA/AMGX.git amgx
cd amgx && git checkout v2.4.0
git submodule update --init --recursive
mkdir build && cd build
cmake .. -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=../install
make -j$(nproc) && make install
cd ../..

# 3. å®‰è£… HYPRE-CPU
wget https://github.com/hypre-space/hypre/archive/refs/tags/v2.31.0.tar.gz
tar xzf v2.31.0.tar.gz
mv hypre-2.31.0 hypre_cpu && cd hypre_cpu/src
./configure --prefix=$PWD/../.. --enable-shared --with-MPI
make -j$(nproc) && make install
cd ../..

# 4. å®‰è£… HYPRE-GPU
cp -r hypre_cpu hypre_gpu && cd hypre_gpu/src
make clean
./configure --prefix=$PWD/../.. --with-cuda --enable-unified-memory --with-gpu-arch=89
make -j$(nproc) && make install
cd ../..

# 5. å®‰è£… PETSc
wget https://web.cels.anl.gov/projects/petsc/download/release-snapshots/petsc-3.22.2.tar.gz
tar xzf petsc-3.22.2.tar.gz && cd petsc-3.22.2
./configure \
  --prefix=$PWD/../petsc-gpu/install \
  --with-cuda=1 --with-cuda-arch=89 \
  --with-cudac=nvcc \
  CUDAFLAGS="-O3 -gencode arch=compute_89,code=sm_89" \
  --with-debugging=0 --with-shared-libraries=1
make all && make install
```

### åœºæ™¯ 2: å¤åˆ¶ç°æœ‰å®‰è£…

```bash
# åœ¨æ—§ç”µè„‘ä¸Šæ‰“åŒ…
cd /home/zzy/Plasma/gpu
tar czf libraries.tar.gz amgx/ hypre_cpu/ hypre_gpu/ petsc-gpu/ ltpDeps-v2412/

# å¤åˆ¶åˆ°æ–°ç”µè„‘
scp libraries.tar.gz newpc:/path/to/

# åœ¨æ–°ç”µè„‘ä¸Šè§£å‹
cd /path/to/
tar xzf libraries.tar.gz

# éªŒè¯åº“æ–‡ä»¶
ls amgx/install/lib/libamgxsh.so
ls hypre_cpu/lib/libHYPRE.a
ls hypre_gpu/lib/libHYPRE.a
ls petsc-gpu/install/lib/libpetsc.so
```

**æ³¨æ„**: å¦‚æœ CUDA ç‰ˆæœ¬ä¸åŒæˆ– GPU æ¶æ„ä¸åŒï¼Œéœ€è¦é‡æ–°ç¼–è¯‘ï¼

---

## ğŸ“ é…ç½®æ–‡ä»¶æ¨¡æ¿

### env_setup.sh æ¨¡æ¿

```bash
# æ ¹æ®æ‚¨çš„å®é™…è·¯å¾„ä¿®æ”¹
export AMGX_DIR="/path/to/amgx/install"
export HYPRE_CPU_DIR="/path/to/hypre_cpu"
export HYPRE_GPU_DIR="/path/to/hypre_gpu"
export PETSC_DIR="/path/to/petsc-gpu/install"
export YAML_CPP_DIR="/path/to/yaml-cpp-master"
```

### CMakeLists.txt æ¨¡æ¿

```cmake
# åœ¨ LinearAlgebra_cuda/CMakeLists.txt ä¸­ï¼ˆç¬¬ 23-27 è¡Œï¼‰
set(HYPRE_CPU_DIR "/path/to/hypre_cpu" CACHE PATH "HYPRE CPU installation directory")
set(HYPRE_GPU_DIR "/path/to/hypre_gpu" CACHE PATH "HYPRE GPU installation directory")
set(PETSC_DIR "/path/to/petsc-gpu/install" CACHE PATH "PETSc directory")
set(AMGX_DIR "/path/to/amgx/install" CACHE PATH "AMGX installation directory")
set(YAML_CPP_DIR "/path/to/yaml-cpp-master" CACHE PATH "yaml-cpp directory")
```

---

## ğŸ¯ å¸¸è§é—®é¢˜

### Q1: HYPRE-CPU å’Œ HYPRE-GPU æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

| ç‰¹æ€§ | HYPRE-CPU | HYPRE-GPU |
|------|-----------|-----------|
| ç¼–è¯‘é€‰é¡¹ | æ ‡å‡† | `--with-cuda` |
| åº“æ–‡ä»¶ | libHYPRE.a | libHYPRE.aï¼ˆå« CUDAï¼‰ |
| ä»£ç  | ç›¸åŒ | ç›¸åŒ |
| è¿è¡Œæ—¶ | è‡ªåŠ¨é€‰æ‹© CPU | è‡ªåŠ¨é€‰æ‹© GPU |

**å…³é”®**: é€šè¿‡ `HYPRE_SetMemoryLocation()` å’Œ `HYPRE_SetExecutionPolicy()` æ§åˆ¶

### Q2: ä¸ºä»€ä¹ˆ PETSc ä¸éœ€è¦åˆ† CPU å’Œ GPU ç‰ˆæœ¬ï¼Ÿ

PETSc çš„è®¾è®¡å“²å­¦ï¼š**ç»Ÿä¸€æ¥å£ï¼Œå¤šåç«¯**

- åŒä¸€ä¸ªåº“ï¼Œç¼–è¯‘æ—¶åŒ…å« CPU å’Œ GPU åç«¯
- é€šè¿‡çŸ©é˜µ/å‘é‡ç±»å‹é€‰æ‹©åç«¯
- `MATAIJ` = CPU, `MATAIJCUSPARSE` = GPU
- æ›´çµæ´»ï¼Œä½†åº“æ›´å¤§

### Q3: å¦‚æœåªéœ€è¦ CPUï¼Œèƒ½ç®€åŒ–å®‰è£…å—ï¼Ÿ

å¯ä»¥ï¼åªå®‰è£… CPU ç‰ˆæœ¬ï¼š

```bash
# ä»…å®‰è£… HYPRE-CPU
# ä»…å®‰è£… PETScï¼ˆä¸å¸¦ --with-cudaï¼‰

# åœ¨ LinearAlgebra_cuda ä¸­ç¦ç”¨ GPU æµ‹è¯•
cmake .. \
  -DBUILD_HYPRE_GPU_TESTS=OFF \
  -DBUILD_PETSC_GPU_TESTS=OFF \
  -DBUILD_AMGX_TESTS=OFF \
  -DBUILD_AMGX_GPU_NATIVE_TESTS=OFF \
  -DBUILD_PETSC_GPU_NATIVE_TESTS=OFF \
  -DBUILD_HYPRE_GPU_NATIVE_TESTS=OFF
```

---

## ğŸ” éªŒè¯å®‰è£…

### éªŒè¯è„šæœ¬

åˆ›å»º `verify_installation.sh`:

```bash
#!/bin/bash

echo "éªŒè¯åº“å®‰è£…..."

# AMGX
if [ -f "/home/zzy/Plasma/gpu/amgx/install/lib/libamgxsh.so" ]; then
    echo "âœ… AMGX: å·²å®‰è£…"
else
    echo "âŒ AMGX: æœªæ‰¾åˆ°"
fi

# HYPRE CPU
if [ -f "/home/zzy/Plasma/gpu/hypre_cpu/lib/libHYPRE.a" ]; then
    echo "âœ… HYPRE CPU: å·²å®‰è£…"
else
    echo "âŒ HYPRE CPU: æœªæ‰¾åˆ°"
fi

# HYPRE GPU
if [ -f "/home/zzy/Plasma/gpu/hypre_gpu/lib/libHYPRE.a" ]; then
    echo "âœ… HYPRE GPU: å·²å®‰è£…"
else
    echo "âŒ HYPRE GPU: æœªæ‰¾åˆ°"
fi

# PETSc
if [ -f "/home/zzy/Plasma/gpu/petsc-gpu/install/lib/libpetsc.so" ]; then
    echo "âœ… PETSc: å·²å®‰è£…"
else
    echo "âŒ PETSc: æœªæ‰¾åˆ°"
fi

# yaml-cpp
if [ -f "/home/zzy/Plasma/gpu/ltpDeps-v2412/extract/yaml-cpp-master/build/libyaml-cpp.a" ]; then
    echo "âœ… yaml-cpp: å·²ç¼–è¯‘"
else
    echo "âŒ yaml-cpp: æœªæ‰¾åˆ°"
fi
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£

- **AMGX**: https://github.com/NVIDIA/AMGX
- **HYPRE**: https://hypre.readthedocs.io/
- **PETSc**: https://petsc.org/release/documentation/
- **yaml-cpp**: https://github.com/jbeder/yaml-cpp

### å·²æœ‰çš„å®‰è£…æ–‡æ¡£

- **AMGX**: `/home/zzy/Plasma/gpu/amgx/INSTALL_INFO.md`
- **PETSc**: `/home/zzy/Plasma/gpu/petsc-gpu/INSTALL_INFO.md`

---

## ğŸ¯ å¿«é€Ÿå‚è€ƒå¡

### å„åº“çš„ CMake å˜é‡

```cmake
# AMGX
set(AMGX_DIR "/path/to/amgx/install")
include_directories(${AMGX_DIR}/include)
target_link_libraries(target ${AMGX_DIR}/lib/libamgxsh.so gomp)

# HYPRE-CPU
set(HYPRE_CPU_DIR "/path/to/hypre_cpu")
include_directories(${HYPRE_CPU_DIR}/include)
target_link_libraries(target ${HYPRE_CPU_DIR}/lib/libHYPRE.a)

# HYPRE-GPU
set(HYPRE_GPU_DIR "/path/to/hypre_gpu")
include_directories(${HYPRE_GPU_DIR}/include)
target_link_libraries(target 
    ${HYPRE_GPU_DIR}/lib/libHYPRE.a
    -lcusparse -lcublas -lcurand -lcusolver)

# PETSc
set(PETSC_DIR "/path/to/petsc-gpu/install")
include_directories(${PETSC_DIR}/include)
target_link_libraries(target ${PETSC_DIR}/lib/libpetsc.so)

# yaml-cpp
set(YAML_CPP_DIR "/path/to/yaml-cpp")
include_directories(${YAML_CPP_DIR}/include)
target_link_libraries(target ${YAML_CPP_DIR}/build/libyaml-cpp.a)
```

### å„åº“çš„ç¼–è¯‘å‘½ä»¤æ€»ç»“

```bash
# AMGX
cmake .. -DCMAKE_INSTALL_PREFIX=../install && make -j && make install

# HYPRE-CPU
./configure --prefix=$PWD && make -j && make install

# HYPRE-GPU
./configure --prefix=$PWD --with-cuda --enable-unified-memory --with-gpu-arch=89
make -j && make install

# PETSc
./configure --prefix=../install --with-cuda=1 --with-cuda-arch=89 \
  CUDAFLAGS="-gencode arch=compute_89,code=sm_89" --with-debugging=0
make all && make install

# yaml-cpp
cmake .. && make -j
```

---

**æ€»ç»“**: 5ä¸ªåº“çš„é…ç½®å„æœ‰ç‰¹ç‚¹ï¼Œå…³é”®æ˜¯ GPU ç›¸å…³çš„å‚æ•°è®¾ç½®æ­£ç¡®ï¼

